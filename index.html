<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Заказ доставки Wildberries</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f8f2f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    /* Логотип */
    .logo {
      margin: 0 auto 25px auto;
      display: block;
      width: 150px;
      height: 50px;
    }
    h2 {
      text-align: center;
      color: #a50064;
      margin-bottom: 20px;
      font-weight: 700;
    }
    form {
      max-width: 420px;
      margin: 0 auto;
      background: #ffffff;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #222;
    }
    .input-wrapper {
      position: relative;
      margin-bottom: 18px;
    }
    input[type="tel"],
    input[type="file"],
    textarea {
      width: 100%;
      padding: 12px 12px 12px 38px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
      background-color: #fafafa;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    input:focus,
    textarea:focus {
      border-color: #a50064;
      outline: none;
      box-shadow: 0 0 8px #a5006440;
    }
    /* Иконки слева в полях */
    .input-wrapper svg {
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      fill: #a50064;
      pointer-events: none;
    }
    /* Радиокнопки */
    .radio-group {
      margin-bottom: 20px;
    }
    .radio-group input[type="radio"] {
      margin-right: 8px;
      cursor: pointer;
    }
    .radio-group label {
      font-weight: 500;
      cursor: pointer;
      color: #333;
    }
    /* Градиентная кнопка */
    button {
      width: 100%;
      background: linear-gradient(90deg, #a50064 0%, #d40082 100%);
      border: none;
      color: white;
      font-size: 18px;
      padding: 14px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 15px;
      transition: background 0.3s ease;
      font-weight: 600;
      box-shadow: 0 4px 8px rgba(212, 0, 130, 0.4);
    }
    button:hover {
      background: linear-gradient(90deg, #8c0056 0%, #bb006f 100%);
      box-shadow: 0 6px 14px rgba(187, 0, 111, 0.6);
    }
    #location-status {
      font-style: italic;
      margin: 10px 0 15px 0;
      color: #555;
      min-height: 20px;
    }
    #photo-preview {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      display: none;
    }
  </style>
</head>
<body>

<!-- Встроенный логотип Wildberries -->
<div class="logo" aria-label="Wildberries">
  <svg width="150" height="50" viewBox="0 0 150 50" fill="none" xmlns="http://www.w3.org/2000/svg" >
    <rect width="150" height="50" rx="8" fill="#a50064"/>
    <path d="M42 37L25 12H34L47 34L58 12H67L51 37H42Z" fill="white"/>
    <path d="M82 37L74 12H81L90 29L99 12H106L98 37H82Z" fill="white"/>
    <path d="M114 37V12H123V37H114Z" fill="white"/>
  </svg>
</div>


<h2>Оформление заказа доставки</h2>

<form id="order-form" autocomplete="off">
  <label for="phone">Номер телефона:</label>
  <div class="input-wrapper">
    <svg viewBox="0 0 24 24"><path d="M6.62 10.79a15.053 15.053 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.21c1.21.49 2.53.76 3.88.76a1 1 0 011 1v3.5a1 1 0 01-1 1C10.57 21.5 2.5 13.43 2.5 3a1 1 0 011-1h3.5a1 1 0 011 1c0 1.35.27 2.67.76 3.88a1 1 0 01-.21 1.11l-2.2 2.2z"/></svg>
    <input
      type="tel"
      id="phone"
      name="phone"
      placeholder="+7XXXXXXXXXX"
      pattern="^\+7\d{10}$"
      required
      title="Введите номер в формате +7XXXXXXXXXX"
    />
  </div>

  <label>Тип доставки:</label>
  <div class="radio-group">
    <input type="radio" id="delivery1" name="delivery_type" value="Обычная доставка (150₽)" checked />
    <label for="delivery1">Обычная доставка — 150₽</label><br />

    <input type="radio" id="delivery2" name="delivery_type" value="Проверка товара курьером (200₽)" />
    <label for="delivery2">Курьер проверяет товар — 200₽</label>
  </div>

  <label for="photo">Фото товара:</label>
  <div class="input-wrapper">
    <svg viewBox="0 0 24 24"><path d="M21 19V7a2 2 0 00-2-2h-3.17a1 1 0 01-.7-.29l-1.83-1.83A2 2 0 0011.83 3H7a2 2 0 00-2 2v14a2 2 0 002 2h12a2 2 0 002-2zM7 7h10v12H7V7z"/></svg>
    <input type="file" id="photo" name="photo" accept="image/*" required />
  </div>
  <img id="photo-preview" alt="Превью фото" />

  <button type="button" id="get-location">
    <svg style="vertical-align:middle; width:20px; height:20px; fill:white; margin-right:6px;" viewBox="0 0 24 24"><path d="M12 2a7 7 0 017 7c0 5.25-7 13-7 13S5 14.25 5 9a7 7 0 017-7z"/></svg>
    Получить геопозицию
  </button>
  <p id="location-status"></p>

  <input type="hidden" id="latitude" name="latitude" />
  <input type="hidden" id="longitude" name="longitude" />

  <button type="submit">Отправить заказ</button>
</form>

<script>
  const locationBtn = document.getElementById('get-location');
  const locationStatus = document.getElementById('location-status');
  const latitudeInput = document.getElementById('latitude');
  const longitudeInput = document.getElementById('longitude');
  const photoInput = document.getElementById('photo');
  const photoPreview = document.getElementById('photo-preview');
  const phoneInput = document.getElementById('phone');

  photoInput.addEventListener('change', () => {
    const file = photoInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        photoPreview.src = e.target.result;
        photoPreview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    } else {
      photoPreview.style.display = 'none';
      photoPreview.src = '';
    }
  });

  locationBtn.onclick = () => {
    if (!navigator.geolocation) {
      locationStatus.textContent = 'Геолокация не поддерживается вашим браузером';
      return;
    }
    locationStatus.textContent = 'Получаем геопозицию...';
    navigator.geolocation.getCurrentPosition(
      position => {
        locationStatus.textContent = 'Геопозиция получена';
        latitudeInput.value = position.coords.latitude;
        longitudeInput.value = position.coords.longitude;
      },
      () => {
        locationStatus.textContent = 'Не удалось получить геопозицию';
      },
      { timeout: 10000 }
    );
  };

  document.getElementById('order-form').onsubmit = async function (e) {
    e.preventDefault();

    const phoneVal = phoneInput.value.trim();

    const phoneValid = /^\+7\d{10}$/.test(phoneVal);
    if (!phoneValid) {
      alert('Введите номер телефона в формате +7XXXXXXXXXX');
      phoneInput.focus();
      return;
    }

    if (!photoInput.files.length) {
      alert('Пожалуйста, выберите фото товара');
      photoInput.focus();
      return;
    }

    if (!latitudeInput.value || !longitudeInput.value) {
      alert('Пожалуйста, получите геопозицию');
      locationBtn.focus();
      return;
    }

    const deliveryType = document.querySelector('input[name="delivery_type"]:checked').value;

    const formData = new FormData();
    formData.append('phone', phoneVal);
    formData.append('photo', photoInput.files[0]);
    formData.append('latitude', latitudeInput.value);
    formData.append('longitude', longitudeInput.value);
    formData.append('delivery_type', deliveryType);

    try {
      const response = await fetch('/send_order', {
        method: 'POST',
        body: formData,
      });
      if (response.ok) {
        alert('Заказ отправлен!');
        this.reset();
        photoPreview.style.display = 'none';
        latitudeInput.value = '';
        longitudeInput.value = '';
        locationStatus.textContent = '';
      } else {
        alert('Ошибка отправки заказа');
      }
    } catch (err) {
      alert('Ошибка отправки заказа');
    }
  };
</script>

</body>
</html>
